{% extends 'facturen/index.html' %}

{% block content %}
<form method="post">
    {% csrf_token %}
    {{ form.as_p }}
    <div id="form-container">
        <!-- Een verborgen kopie van een form om te klonen -->
        <div style="display: none;" class="form-copy">
            <hr>
            {{ formset.empty_form.as_p }}
        </div>
        {% for form in formset %}
            <div class="factuurregel-form" data-index="{{ forloop.counter0 }}">
                <hr>
                {{ form.as_p }}
                {% if not forloop.first %}
                    <button type="button" class="delete-button">Delete</button>
                {% endif %}
            </div>
        {% endfor %}
    </div>
    <button type="button" id="add-more">Add more</button>
    <button type="submit">Submit</button>
</form>

<script type="text/javascript">
    document.addEventListener('DOMContentLoaded', function () {
        var formCount = parseInt('{{ formset.total_form_count }}');
        var addButton = document.getElementById('add-more');
        var formContainer = document.getElementById('form-container');
    
        addButton.addEventListener('click', function() {
            var newForm = formContainer.querySelector('.form-copy').cloneNode(true);
            var formRegex = RegExp('form-(\\d+)-', 'g');
    
            formContainer.appendChild(newForm);
            newForm.innerHTML = newForm.innerHTML.replace(formRegex, 'form-' + formCount + '-');
            newForm.style.display = 'block';
    
            // Voeg een verwijderknop toe aan de nieuwe form
            var deleteButton = document.createElement('button');
            deleteButton.type = 'button';
            deleteButton.classList.add('delete-button');
            deleteButton.textContent = 'Delete';
            newForm.appendChild(deleteButton);
    
            formCount++;
    
            // Update het aantal forms in de management form
            document.getElementById('id_form-TOTAL_FORMS').value = formCount;
        });
    
        formContainer.addEventListener('click', function(e) {
            if (e.target.classList.contains('delete-button')) {
                // Voorkom dat de eerste factuurregel verwijderd wordt
                var formIndex = e.target.parentNode.getAttribute('data-index');
                if (formIndex != '0') {  // Controleer of het niet de eerste form is
                    e.target.parentNode.remove();
                }
            }
        });
    });
</script>

{% endblock content %}
    
    